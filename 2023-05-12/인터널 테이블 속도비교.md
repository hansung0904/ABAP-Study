# 인터널 테이블 속도 비교
ABAP 프로그램에서 인터널 테이블을 잘 활용하는 것은 성능에 큰 영향을 미치는 중요한 변수이다.

## **1 Standard vs. Sorted Table**

<img src="https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/fc/eb366d358411d1829f0000e829fbfe/loioff8de3281b4f49e3a45a47e9e40e1985_LowRes.png" width = "400" height="300">

Standard Table과 Sorted Table은 모두 Index 테이블이다.
프로그램에서 자주 사용하는(탐색 속도를 개선해주는) <br>
BINARY SEARCH 구문의 측면에서 두 가지 테이블을 비교해 보자.

위 그림에서 보면 Standard Table의 Key Access 속도는 인터널 테이블의 Line 수에 따라 선형 종속적으로(Linearly) <br>
증가하게 되고, Sorted Table은 지수 함수 (Logarithmically)로 증가하게 된다. <br>
즉, 테이블의 건수가 증가할수록 Sorted Table의 탐색 속도가 월등히 빠르다는 것을 보여주고 있다. <br>

## 교육용 서버에서 두 가지 타입의 인터널 테이블에 천만 건의 라인을 생성하고 난 뒤 테스트한 결과

|구문|Standard Table|Sorted Table|
|------|---|---|
|APPEND 속도|6,203ms<br>6,219ms<br>6,172ms|14,761ms<br>14,797ms<br>14,782ms|
|READ 속도|609ms<br>734ms<br>574ms<br>|94ms<br>62ms<br>62ms|
|결론|APPEND속도 빠름<br>READ 속도 느림<br>|APPEND속도 느림<br> READ 속도 빠름|

테스트 결과를 보면 Sorted Table은 READ 속도가 월등히 우수하지만, Line을 추가하면서 정렬하기 때문에 APPEND 구문에서 속도가 많이 느림.

대용량 데이터를 다룰 때에는 두 가지 타입을 잘 구분해서 사용하도록 하자.<br>
성능 측면에서 큰 차이를 가져올 수 있기 때문.<br><br>
예를 들어, 고객 정보 백만 건을 처리하는 프로그램에서 고객번호, 주민번호, 이름 등의 칼럼으로 탐색(READ) 
하는횟수가 많아지게 된다면 Sorted Table을 사용하는것이 효율적이겠지?

## 2 BINARY SEARCH(Standard Internal Table)

BINARY SEARCH는 이진 트리를 이용해서 값을 찾는 방법으로 먼저 데이터를 키값(컬럼) 기준으로 정렬해주어야 한다.
```ABAP
READ TABLE <itab> WITH KEY coll BINARY SEARCH.
```
<br>
Standard Table로 선언했을 때는 데이터 건수가 많을수록 정렬 시간이 지연되므로 SORT 하는데 들어간 시간이 <br>
BINARY SEARCH로 얻을 수 있는 시간감소량보다 더 많이 소요될 수 있다. <br>
그러므로 무조건 Sort해서 BINARY SEARCH 하는 것은 바람직 하지 않을 수도 있다.<br>
테이블 타입, 테입르 건수와 같은 조건에 따라 정반대의 결과를 가져올 수 있으므로 제대로 알고 사용하도록 하자
<br><br>
예를 들어 10,000건의 데이터 인터널 테이블을 LOOP 처리하는 경우라면 LOOP 이전에 SORT를 하고 <br>
BINARY SEARCH 해주는게 훨씬 더 빠른 성능을 제공한다.<br>
&emsp; 물론 테이블 건수에 따라 다를 순 있다.<br><br>
튜닝 프로젝트를 하게 되면 BINARY SEARCH 하라는 문구가 많다.<br>

```ABAP
    LOOP AT itab.
        READ TABLE ITAB WITH KEY ~ ENDLOOP.
```
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;⏬

```ABAP
    SORT ITAB BY F1.
    LOOP AT itab.
        READ TABEL ITAB WITH KEY ~ BINARY SEARCH.
    ENDLOOP.    
```

## BINARY SEARCH vs SORTED
Sorted Table은 이미 데이터가 정렬되어 있어서 SORT 명령어가 필요 없고, BINARY SEARCH 구문도 사용할 필요가 없다<br>
프로그램에서 인터널 테이블을 한 번만 READ 하는 경우는 거의 없고 5회 이상만 READ 구문을 사용하더라도 프로그램의<br>
성능은 크게 향상된다.

## 4 Hashed Table 속도 측정
Hashed Table은 테이블을 READ 할 때 Hash 알고리즘을 사용하기 때문에 항상 같은 속도의 테입르 접근이 가능하지만 INSERT 시 속도가 지연된다.<br>
그리고 항상 키값을 Unique 하게 선언해주어야 한다.

Hahsed Table은 Key값을 Unique 하게 구분할 수 있으며 대용량 데이터이고 READ 구문이 자주 사용된다면 <br>
Hashed Table을 사용하는 것이 바람직하다. <br>
성능을 고려해야 하는 프로그램은 처음 설계부터 Unique 한 Key 값을 인터널 테이블로 선언해서 프로그래밍<br> 하는 습관을 가지도록 하자.
