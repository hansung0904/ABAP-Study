# 필드 카탈로그
필드 카탈로그는 ALV에서 조회되는 칼럼들의 필드 정보를 포함하는 LVC_F_FCAT 타입의 테이블 구조를 가진다. <br>
ALV는 필드 카탈로그 정보를 저장하는 인터널 테이블을 이용해서 필드 타입을 인식하게 된다. <br>
예를 들어, 필드가 숫자 타입인지 문자 타입인지 구분하며, 화면에 보여줄 필드 길이를 지정하고, <br>
체크박스-라디오 버튼으로 보이게하고, 필드 수정이 가능하게 하는 등의 많은 역할을 하게 된다.

![](https://raw.githubusercontent.com/hansung0904/ABAP-Study/main/EasyABAPCapture/ALV%20%ED%95%84%EB%93%9C%20%EC%B9%B4%ED%83%88%EB%A1%9C%EA%B7%B8%20%EA%B5%AC%EC%A1%B0.png)

ABAP Dictionary 구조체를 이용해서 아웃풋 테이블의 필드를 구성했으나 <br>
이번 장에서는 개발자가 스크립트를 이용해서 직접 필드 카탈로그를 구성하는 실습을 하게 된다. <br>
필드 카탈로그를 활용하려면 set_table_for_first_display 메서드의 파라미터 IF_FIELDCATALOG를 이용해서 필드 카탈로그 정보를 ALV에 전송하게 된다.

필드 카탈로그를 정의하는 방법은 3가지이다. <br>

**• ABAP Dictionary 오브젝트를 이용하는 방법 <br>**
**• 프로그램 내에서 스크립트로(수동으로) 구성하는 방법<br>**
**• 위 두 가지 방법을 혼합해서 사용하는 방법<br>**

## ALV 필드 카탈로그 생성 
**1 ABAP Dictionary를 이용하는 방법** <br>
set_table_for_first_display 메서드의 **I_STRUCTRUE_NAME** 파라미터를 이용하면 ABAP Dictionary 오브젝트를 ALV 아웃풋 테이블에 그대로 보여주게 된다. <br>
I_STRUCTRE_NAME 파라미터로 사용할 수 있는 ABAP Dictionary는 다음과 같다.

**• Transparent Table <br>**
**• Structure<br>**
**• View<br>**
**• Append Structure<br>**
**• Cluster Table<br>**
**• Pooled Table<br>**

단순히 데이터만 화면에 보여주려면 다음 구문과 같이 ALV 구조 정보와 인터널 테이블을 파라미터로 설정해서 <br> set_table_for_first_display 메서드만 호출하자.
```ABAP
CALL METHOD <ref var to CL_GUI_ALV_GRID>->set_table_for_first_display
    EXPORTING
        I_STRUCTURE_NAME = <string of type DD02L-TABNAME>
        IS_VARIANT  =   <structure of type DISVARIANT>
        I_SAVE  =   <var. of TYPE cHAR01>
        I_DEFAULT   =   <var. of TYPE cHAR01>
        IS_LAYOUT = < structure of type LVC_S_LAYO>
        IS_PRINT = < structure of type LVC_S_PRNT>
        IT_SPECIAL_GROUPS = < internal table of type LVC_T_SGRP>
        IT_TOOLBAR_EXCLUDING = < internal table of type UI_FUNCTIONS>
    CHANGING
        IT_OUTTAB = < internal table>
        IT_FIELDCATALOG = < internal table of type LVC__T_FCAT>
        IT_FILTER = < internal table of type LVC_T_FILT>
```

그러나 대부분의 실무 프로그램에서는 여러 개의 테이블에서 데이터를 가져오기 때문에 테이블 구조를 <br> 필드 카탈로그에 그대로 사용할 수 있는 경우가 그리 많지 않다. 이때는 ABAP Dictionary 레벨에서 구조체를 생성해서 인터널 테이블은 구조체를 참고해서 정의하게 된다. <br>
그러나 하나의 프로그램에서만 필요한 구조체라면 굳이 ABAP Dictionary 구조체를 생성할 필요는 없다.<br>
이럴 때에는 인터널 테이블 구조를 그대로 필드 카탈로그로 정의할 수 있다.

**2 필드 카탈로그를 수동으로 구성하는 방법** <br>
ABAP Dictionary의 모든 필드를 필드 카탈로그로 보여주고 싶지 않은 경우가 있다. 이럴 때는 <br>
스크립트(수동으로) 필요한 필드만 카탈로그로 정의할 수 있다. 그리고 생성된 필드 카탈로그 인터널 테이블의 속성을 변경해서 비가시 속성을 설정할 수도 있다. <br>
그러나 개별 필드 이름, 타입 등을 스크립트로 모두 정의하여야 하므로 프로그램 수정(유지/보수)에 많은 시간이 소요되는 단점이 있다. <br>
필드 카탈로그를 이용하려면 set_table_for_first_display 메서드의 IT_FIELDCATALOG 파라미터를 이용해서 ALV를 호출하게 된다.

```ABAP
CALL METHOD <ref var to CL_GUI_ALV_GRID>->set_table_for_first_display
    EXPORTING
        IS_VARIANT  =   <structrue of type DISVARIANT>
        I_SAVE  =   <var. of TYPE cHAR01>
        I_DEFALUT  =   <var. of TYPE cHAR01>
        I_LAYOUT  =   <structure of type LVC_S_LAYO>
        I_PRINT  =   <structure of type LVC_S_PRNT>
        IT_SPECIAL_GROUPS = < internal table of type LVC_T_SGRP> 
        IT_TOOLBAR_EXCLUDING = < internal table of type UI_FUNCTIONS>
CHANGING        
    IT_OUTTAB = < internal table〉
    IT_FIELDCATALOG = < internal table of type LVC__T_FCAT>
    IT_SORT = < internal table of type LVC_T_SORT>
    IT FILTER = < internal table of type LVC__T_FILT>
```

아래의 표는 필드 LVC_T_FCAT 타입의 인터널 테이블을 구성할 때, ABAP Dictionary의 테이블과 필드의 속성을 <br> 상속받을 것인지 아니면 직접 속성(길이,타입 등)을 정의할 것인지에 대해서 설명하고 있다.

|Dictionary를 참고할 때|Dictionary를 참고하지 않을때|설명|
|------|---|---|
|FIELDNAME|FIELDNAME|아웃풋 테이블의 필드 이름|
|REF_TABNAME|-|참고할 구조체의 DDIC 이름|
|REF_FIELDNAME|-|참고할 구조체의 DDIC 필드 이름|
|-|INTTYPE|아웃풋 테이블의 DATA TYPE|
|-|OUTPUTLEN|칼럼 길이|
|-|COLTEXT|칼럼 헤더 텍스트|
|-|SELTEXT|Variant 조회 시 칼럼 내역|

필드 카탈로그를 이용해서 다음과 같은 속성들의 정의할 수 있다. <br>
**• 필드 위치 <br>**
**• 색상<br>**
**• 필드명<br>**
**• 텍스트 Currency 단위<br>**
**• 칼럼 Output 속성<br>**
**• 데이터 포맷 설정<br>**

아래 표는 필드 카탈로그의 전체 속성이다.
|카탈로그 속성|내용|사용 목적|
|------|---|---|
|CFIELDNAME|Currency 단위를 참고하는 필드 이름|단위와 함께 값을 보여준다.|
|CHECKBOX|체크박스로 보여준다.|칼럼 아웃풋 옵션|
|COL_POS|칼럼의 output 순서|칼럼 아웃풋 옵션|
|COLDDICTXT|Header의 라벨 설정(L, M, S, R)|텍스트|
|COLTEXT|칼럼 라벨 텍스트|텍스트|
|CURRENCY|Currency 단위|단위와 함께 값을 보여준다.|
|DD_OUTLEN|Output 길이 (Characters)|DDIC를 참고하지 않음|
|DECIMALS_O|소숫점 자릿수 정의|칼럼 값의 포맷|
|DECMLFIELD|Decimal 필드 정의|칼럼 값의 포맷|
|DO_SUM|합계 표시|칼럼 아웃풋 옵션|
|DRAGDROPID|Drag & Drop 용도||
|EDIT_MASK|데이터 포맷 변경|칼럼 값의 포맷|
|EMPHASIZE|칼럼 색상 강조|칼럼 아웃풋 옵션|
|EXPONENT|부동 표현에 대한 지수|칼럼 값의 표맷|
|FIELDNAME|내부 테이블 필드의 필드이름|아웃풋 테이블 필드|
|HOTSPOT|마우스의 Single-click에 반응|칼럼의 아웃풋 옵션|
|ICON|Icon으로 보여줌|칼럼 값의 포맷|
|INTLEN|내부 길이(바이트 단위)|DDIC를 참고하지 않음|
|INTTYPE|ABAP 데이터 타입(C, D, N ...)|DDIC를 참고하지 않음|
|JUST|정렬 (L, R, C)|칼럼 값의 포맷|
|KEY|Key 필드|칼럼 아웃풋 옵션|
|LOWERCASE|소문자 사용/금지|칼럼 아웃풋 옵션|
|LZERO|선행에 제로 출력 여부|칼럼 값의 포맷|
|NO_OUT|필드 숨김|칼럼 아웃풋 옵션|
|NO_SIGN|출력 부호 제거|칼럼 값의 포맷|
|NO_SUM|열 값에 합계 처리하지 않음|칼럼 아웃풋 옵션|
|NO_ZERO|ZERO 삭제|칼럼 값의 포맷|
|OUTPUTLEN|문자의 열 너비|칼럼의 아웃풋 옵션|
|QFIELDNAME|참조한 단위 필드이름|단위와 함께 값을 보여준다.|
|QUANTITY|단위|단위와 함께 값을 보여준다.|
|REF_FIELD|내부 테이블 필드에 대한 참조 필드 이름|ABAP Dictionary 참고|
|REF_TABLE|내부 테이블 필드에 대한 참조 테이블 이름|ABAP Dictionary 참고|
|REPTEXT|Data Element의 텍스트|텍스트|
|ROLLNAME|F1 도움말을 위한 데이터 요소|DDIC를 참고하지 않음|
|ROUND|ROUND 값|칼럼 값의 포맷|
|ROUNDFIELD|ROUND 특성이 있는 필드 이름|칼럼 값의 포맷|
|SCRTEXT-L|긴 필드 라벨(40byte)|텍스트|
|SCRTEXT-M|중간 필드 라벨(20byte)|텍스트|
|SCRTEXT-S|짧은 필드 라벨(20byte)|텍스트|
|SELDDICTXT|DDIC 텍스트 참조 결정|텍스트|
|SELTEXT|다이얼로그 기능에 대한 열 식별자|텍스트|
|SP_GROUP|그룹 키|Other Fields|
|SYMBOL|기호로 출력|칼럼 값의 포맷|
|TECH|Layout 설정에서도 필드가 보이지 않게 함|칼럼 아웃풋 옵션|
|TIPDDICTXT|DDIC 텍스트 참조 결정|텍스트|
|TOOLTIP|열 헤더에 대한 툴 팁|텍스트|
|TXT_FIELD|내부 테이블 필드의 필드 이름|Other Fields|

## 3 구조체와 필드 카탈로그를 동시에 적용
1에서의 구조체와 2에서의 필드 카탈로그 두 가지를 혼합해서 사용할 수 있다. <br>
구조체의 필드 이외에 사용자가 정의하는 필드가 추가로 필요한 경우에 사용하기 적합하다.<br>
이때 구조체와 필드 카탈로그에 같은 필드가 존재하게 되면, 필ㄷ그 카탈로그에서 정의한 필드가 높은 우선 순위를 가지게 된다.<br>
버전에 따라 다르지만, 데이터를 저장하는 인터널 테이블에 COMPANY필드도 추가되어야 한다.<br>